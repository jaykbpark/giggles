# Cursor Rules - Clip (nw2025)

> **Project:** Clip (iOS companion app for Meta Ray-Ban glasses)  
> **Platform:** iOS 26+ (SwiftUI + Liquid Glass)  
> **UI Direction:** Warm minimal, timeline-first

Development progress lives in [`frontend/PROGRESS.md`](frontend/PROGRESS.md).

---

## Non-Negotiable Workflow

### 1) Pull first, always
```bash
cd /Users/jaypark/Documents/GitHub/nw2025 && git pull origin main
git log --oneline -10
```
After pulling, **explicitly say**: "Pulled latest and on `main`."

### 2) Build + run after any code change

> **‚ö†Ô∏è IMPORTANT: Before building, ASK the user if they want Mock Mode ON or OFF.**
> - **Mock Mode ON:** Use when no physical Meta glasses are connected (simulator or device without glasses)
> - **Mock Mode OFF:** Use when physical Meta Ray-Ban glasses are paired and connected
> - If user hasn't specified, **ask before proceeding with the build**

**Simulator with Mock Mode (recommended for simulator):**
```bash
cd /Users/jaypark/Documents/GitHub/nw2025/frontend && \
xcodebuild -project nw2025.xcodeproj -scheme nw2025 \
  -destination 'platform=iOS Simulator,name=iPhone 17 Pro' \
  -configuration Debug build && \
xcrun simctl boot "iPhone 17 Pro" || true && \
xcrun simctl install "iPhone 17 Pro" ~/Library/Developer/Xcode/DerivedData/nw2025-*/Build/Products/Debug-iphonesimulator/nw2025.app && \
SIMCTL_CHILD_USE_MOCK_GLASSES=1 xcrun simctl launch "iPhone 17 Pro" me.park.jay.nw2025
```

**Simulator without Mock Mode (real SDK):**
```bash
cd /Users/jaypark/Documents/GitHub/nw2025/frontend && \
xcodebuild -project nw2025.xcodeproj -scheme nw2025 \
  -destination 'platform=iOS Simulator,name=iPhone 17 Pro' \
  -configuration Debug build && \
xcrun simctl boot "iPhone 17 Pro" || true && \
xcrun simctl install "iPhone 17 Pro" ~/Library/Developer/Xcode/DerivedData/nw2025-*/Build/Products/Debug-iphonesimulator/nw2025.app && \
xcrun simctl launch "iPhone 17 Pro" me.park.jay.nw2025
```

**Device with Mock Mode:**
```bash
cd /Users/jaypark/Documents/GitHub/nw2025/frontend && \
xcodebuild -project nw2025.xcodeproj -scheme nw2025 \
  -destination 'id=00008140-001534E83647001C' \
  -configuration Debug -allowProvisioningUpdates build && \
xcrun devicectl device install app --device 00008140-001534E83647001C \
  ~/Library/Developer/Xcode/DerivedData/nw2025-*/Build/Products/Debug-iphoneos/nw2025.app && \
xcrun devicectl device process launch --device 00008140-001534E83647001C \
  --environment USE_MOCK_GLASSES=1 me.park.jay.nw2025
```

**Device without Mock Mode (real glasses connected):**
```bash
cd /Users/jaypark/Documents/GitHub/nw2025/frontend && \
xcodebuild -project nw2025.xcodeproj -scheme nw2025 \
  -destination 'id=00008140-001534E83647001C' \
  -configuration Debug -allowProvisioningUpdates build && \
xcrun devicectl device install app --device 00008140-001534E83647001C \
  ~/Library/Developer/Xcode/DerivedData/nw2025-*/Build/Products/Debug-iphoneos/nw2025.app && \
xcrun devicectl device process launch --device 00008140-001534E83647001C me.park.jay.nw2025
```

If build/run fails, **stop and report the error**.

### 3) Commit/push only after user confirms it works
```bash
git add -A
git commit -m "<type>: <summary>"
git push origin main
```

Commit types: `Feat`, `Fix`, `UI`, `Refactor`, `Chore`.

After pushing, **explicitly say**: branch + commit hash + summary.

---

## Design Rules (Liquid Glass)

- Use `.glassEffect()` for chrome and controls.
- Use `.glassEffect(.regular.interactive())` for tappable elements.
- Avoid glass on primary content blocks (transcripts, timeline cards).

Docs:  
`/Applications/Xcode.app/Contents/PlugIns/IDEIntelligenceChat.framework/Versions/A/Resources/AdditionalDocumentation/`

---

## Product Structure (Reference)

```
ClipApp/
‚îú‚îÄ‚îÄ App/                 // ClipApp.swift, GlobalViewState.swift
‚îú‚îÄ‚îÄ Core/                // Managers, Navigation, DesignSystem
‚îú‚îÄ‚îÄ Features/Feed/       // TimelineView, MomentCard, ClipDetailView
‚îú‚îÄ‚îÄ Models/              // ClipMetadata, SearchResult
‚îî‚îÄ‚îÄ Services/            // APIService, MockData
```

---

## Wake Word (Clip That)

Location: `Core/Managers/WakeWordDetector.swift`

```swift
wakeWordDetector.startListening(audioFormat: format)
wakeWordDetector.processAudioBuffer(buffer)
wakeWordDetector.onClipTriggered = { transcript in ... }
```

---

## Meta Wearables SDK

SPM URL: `https://github.com/facebook/meta-wearables-dat-ios`  
Docs: `https://wearables.developer.meta.com/docs/develop`

### Mock Mode

The app supports a mock glasses provider for development without physical hardware.

- **Environment Variable:** `USE_MOCK_GLASSES=1`
- **Simulator:** Use `SIMCTL_CHILD_USE_MOCK_GLASSES=1` prefix before `xcrun simctl launch`
- **Location:** `Core/Managers/MetaGlasses/`
  - `MetaGlassesManager.swift` - Unified interface, auto-selects provider
  - `MockGlassesProvider.swift` - Generates synthetic video/audio
  - `MetaSDKProvider.swift` - Real SDK integration

When mock mode is enabled, you'll see: `üï∂Ô∏è MetaGlassesManager: Using MOCK provider`

